var lat=37.4501089,lng=126.9528387,radius=500,loc=new naver.maps.LatLng(lat,lng),map=new naver.maps.Map("map",{center:loc,zoom:15}),red_marker={content:'<img src="img/sold-out.png">',size:{width:30,height:30}},blue_marker={content:'<img src="img/in-stock.png">',size:{width:30,height:30}},circle=new naver.maps.Circle({map:map,center:loc,radius:radius,strokeColor:"#3cc79e",strokeOpacity:.7,storkeWeight:1,fillColor:"#fff498",fillOpacity:.5}),xhr=new XMLHttpRequest,markers=[];function moveCenter(e){var t=e._lat,n=e._lng;xhr.open("GET","https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByGeo/json?lat="+t+"&lng="+n+"&m="+radius),xhr.send(),circle.setCenter(e)}function changeRadius(e){radius=parseInt(e),circle.setRadius(radius),moveCenter(map.getCenter())}xhr.onreadystatechange=function(){xhr.readyState===XMLHttpRequest.DONE&&(200===xhr.status?(markers.map(function(e){e[0].setMap(null),e[1].setMap(null)}),markers=JSON.parse(xhr.responseText).stores.map(function(e){var t=new naver.maps.Marker({position:new naver.maps.LatLng(e.lat,e.lng),map:map,icon:e.sold_out?red_marker:blue_marker}),n=e.stock_t.split(":"),a=['<div class="info_box '+(e.sold_out?"sold_out":"in_stock")+'">',"  <h3>"+e.name+"</h3>",'  <p class="addr">'+e.addr+"</p>","  <p>재고: "+e.remain_cnt+"/"+e.stock_cnt+" | "+n[0]+"시 "+n[1]+"분 입고</p>","</div>"].join(""),o=new naver.maps.InfoWindow({content:a,maxWidth:280,pixelOffset:new naver.maps.Point(0,-20),disableAutoPan:!0});return naver.maps.Event.addListener(t,"click",function(e){o.getMap()?o.close():o.open(map,t)}),[t,o]})):alert("데이터 가져오기 에러"))},naver.maps.Event.once(map,"init_stylemap",function(){var e=['<div class="dist_ctl">','<input type="button" class="btn" val="200" value="200m">','<input type="button" class="btn" val="500" value="500m">','<input type="button" class="btn" val="1000" value="1km">',"</div>"].join(""),t=new naver.maps.CustomControl(e,{position:naver.maps.Position.BOTTOM_CENTER});t.setMap(map);var n=t.getElement().firstChild.children;Array.prototype.slice.call(n).map(function(e){naver.maps.Event.addDOMListener(e,"click",function(){changeRadius(e.getAttribute("val"))})})}),naver.maps.Event.addListener(map,"center_changed",_.debounce(moveCenter,100)),window.addEventListener("load",function(){var e,t=document.getElementById("can_buy"),n=(new Date).getDay();e=1<=n&&n<=5?"XXX"+n+"년생과 XXX"+(n+5)%10+"년생의":"모두",t.innerText="오늘은 "+e+" 구입 가능합니다.",navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){console.log(e),loc=new naver.maps.LatLng(e.coords.latitude,e.coords.longitude),map.setCenter(loc)},function(){console.log("failed to get location"),moveCenter(loc)}):moveCenter(loc)});