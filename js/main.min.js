!function(){var t=500,e=new naver.maps.LatLng(37.4501089,126.9528387),n=new naver.maps.Map("map",{center:e,zoom:15}),a={content:'<img src="img/sold-out.png">',size:{width:30,height:30}},o={content:'<img src="img/in-stock.png">',size:{width:30,height:30}},i=new naver.maps.Circle({map:n,center:e,radius:t,strokeColor:"#3cc79e",strokeOpacity:.7,storkeWeight:1,fillColor:"#fff498",fillOpacity:.5}),s=new XMLHttpRequest,r=[];function c(e){var n=e._lat,a=e._lng;s.open("GET","https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByGeo/json?lat="+n+"&lng="+a+"&m="+t),s.send(),i.setCenter(e)}s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?(r.map(function(t){t[0].setMap(null),t[1].setMap(null)}),r=JSON.parse(s.responseText).stores.map(function(t){var e=new naver.maps.Marker({position:new naver.maps.LatLng(t.lat,t.lng),map:n,icon:t.sold_out?a:o}),i=t.stock_t.split(":"),s=['<div class="info_box '+(t.sold_out?"sold_out":"in_stock")+'">',"  <h3>"+t.name+"</h3>",'  <p class="addr">'+t.addr+"</p>","  <p>재고: "+t.remain_cnt+"/"+t.stock_cnt+" | "+i[0]+"시 "+i[1]+"분 입고</p>","</div>"].join(""),r=new naver.maps.InfoWindow({content:s,maxWidth:280,pixelOffset:new naver.maps.Point(0,-20),disableAutoPan:!0});return naver.maps.Event.addListener(e,"click",function(t){r.getMap()?r.close():r.open(n,e)}),[e,r]})):alert("데이터 가져오기 에러"))},window.addEventListener("load",function(){var a,o=document.getElementById("can_buy"),s=(new Date).getDay();if(a=1<=s&&s<=5?"XXX"+s+"년생과 XXX"+(s+5)%10+"년생의":"모두",o.innerText="오늘은 "+a+" 구입 가능합니다.","1"!==function(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}("agree")){if(!confirm("제공되는 정보는 5분 이상 지연된 데이터입니다. 이에 동의하시겠습니까?"))return void alert("동의를 하지 않아 해당 서비스 사용이 불가합니다.");!function(t,e,n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var o="expires="+a.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"}("agree",1,365)}var r=['<div class="dist_ctl">','<input type="button" class="btn" val="200" value="200m">','<input type="button" class="btn" val="500" value="500m">','<input type="button" class="btn" val="1000" value="1km">',"</div>"].join(""),l=new naver.maps.CustomControl(r,{position:naver.maps.Position.BOTTOM_CENTER});l.setMap(n);var p=l.getElement().firstChild.children;Array.prototype.slice.call(p).map(function(e){naver.maps.Event.addDOMListener(e,"click",function(){var a=e.getAttribute("val");t=parseInt(a),i.setRadius(t),c(n.getCenter())})}),naver.maps.Event.addListener(n,"center_changed",_.debounce(c,100)),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e=new naver.maps.LatLng(t.coords.latitude,t.coords.longitude),n.setCenter(e)},function(){console.log("failed to get location"),c(e)}):c(e)})}();